@model ClienteHomeViewModel;
@{
    ViewData["Title"] = Model.Nome;
    Layout = "_LayoutClienti";
}

@section Header{
    <environment exclude="Development">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css" integrity="sha256-Tu3DN+5kwrhzlzhNUMuGht2h7cR6ARgKcYemB9u5SzA=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.4.1/css/swiper.min.css" integrity="sha256-z78IDnzMlkZK8v2CTwM19nwgmpqbCSYiRtBGqX9bmsA=" crossorigin="anonymous" />
    </environment>
    <environment include="Development">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css" integrity="sha256-Tu3DN+5kwrhzlzhNUMuGht2h7cR6ARgKcYemB9u5SzA=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.4.1/css/swiper.css" integrity="sha256-PrnIGltkTKTE3bcfk7Wqq991vuscF9HovIiEHPNZn08=" crossorigin="anonymous" />
    </environment>

}

<section id="clientHeroes" class="">
    <div class="row">
        <div class="clientHeroes text-center" style="background-image: url('@Model.ImmagineHome.Url'); background-size:cover;">
            <h2 class="section-title text-uppercase">@Model.RagioneSociale</h2>
        </div>
    </div>

    @if (ViewBag.UtenteNormale)
    {
        <div class="row right-align">
            @if (ViewBag.IsFollowing)
            {
                <form asp-action="RemoveAssociazioneUserToCliente" asp-controller="Clienti" method="post">
                    <button class="btn waves-effect waves-light medium" type="submit" name="action">
                        <i class="Large material-icons">favorite</i> Unfollow
                    </button>
                </form>
            }
            else
            {
                <form asp-action="AddAssociazioneUserToCliente" asp-controller="Clienti" method="post">
                    <button class="btn waves-effect waves-light medium" type="submit" name="action">
                        <i class="Large material-icons">favorite_border</i> Follow
                    </button>
                </form>
            }
        </div>
    }
</section>

<section id="banner1">
    <div class="row center-align">
        <div class="adsbanner_container">
            <img src="~/img/placeholders/google/leaderboard_728x90.png" />
        </div>
    </div>
</section>

<section id="slideshow" class="padding-top-110">
    <div class="row">
        <div class="swiper-container">
            <div class="swiper-wrapper">
                @foreach (var i in Model.Images)
                {
                    <div class="swiper-slide center">
                        <img class="r2d-swiper-image center" src="@i.Url" alt="@i.Alt">
                    </div>
                }
            </div>
            <!-- Add Pagination -->
            <div class="swiper-pagination"></div>
            <!-- Add Arrows -->
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>
    </div>
</section>

<section id="descCliente" class="padding-top-10 mt-10">
    <div class="row">
        <div class="col-sm-1 col-md2">&nbsp;</div>
        <div class="col-sm10 col-md8">
            <h1>@Model.Nome</h1>
            <h3>
                @Model.Descrizione
            </h3>
        </div>
        <div class="col-sm-1 col-md2">&nbsp;</div>
    </div>
</section>


<section id="banner2">
    <div class="row center-align">
        <div class="adsbanner">
            <img src="~/img/placeholders/google/leaderboard_728x90.png" />
        </div>
    </div>
</section>

<section id="calendars">
    <div class="row">
        @if (ViewBag.Sale != null && ViewBag.Sale.Count > 0)
        {
            <!-- TABS SALE-->
            <div class="col s12">
                <ul id="tabsContainer" class="tabs tabs-fixed-width">
                    @foreach (var s in ViewBag.Sale)
                    {
                        <li class="tab col s3">
                            <a href='@(String.Format("#calendar-{0}",s.Id))'>@s.Nome</a>
                        </li>
                    }
                </ul>
            </div>
            <!-- Un DIV per ciascuna sala con il calendario per quella sala -->
            @foreach (var s in ViewBag.Sale)
            {
                <div id="@(String.Format("calendar-container-{0}",s.Id))">
                    <div id='@(String.Format("calendar-{0}",s.Id))'>

                    </div>
                </div>
            }
        }
        else
        {
            <h4><a asp-controller="Clienti" asp-action="SalaNew">Configurare</a> almeno una Sala per poter iniziare ad inserire gli eventi.</h4>
        }
    </div>
</section>

<section id="whereare">
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8">
            <img class="responsive-img" src="@ViewBag.MapUrl" />
        </div>
        <div class="col-md-2"></div>
    </div>
</section>

@section Scripts{
    <environment include="Development">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.4.1/js/swiper.js" integrity="sha256-oJJHkizrUKFt3RxI+6CGUF/ILj4N4SBLKq60GgkcLfY=" crossorigin="anonymous"></script>
        <!-- MomentJS e FullCalendar-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.js" integrity="sha256-59IZ5dbLyByZgSsRE3Z0TjDuX7e1AiqW5bZ8Bg50dsU=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/locale/it.js" integrity="sha256-D8y560ZGsKY1LoAajKkQCG7y0Vkye361MH4yFv2K5kk=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.js" integrity="sha256-uKe4jCg18Q60qLNG8dIei2y3ZVhcHADuEQFlpQ/hBRY=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/locale/it.js" integrity="sha256-Y2D8xTTlSrBTcjPKKOeBs0zxdp9rupAIQiQZkbxVAfo=" crossorigin="anonymous"></script>
    </environment>
    <environment exclude="Development">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.4.1/js/swiper.min.js" integrity="sha256-bX3ZexuPmm3WbMkCXTtmA9NxFzcS0QP6Jz4gowE6U3A=" crossorigin="anonymous"></script>
        <!-- MomentJS e FullCalendar-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js" integrity="sha256-CutOzxCRucUsn6C6TcEYsauvvYilEniTXldPa6/wu0k=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/locale/it.js" integrity="sha256-D8y560ZGsKY1LoAajKkQCG7y0Vkye361MH4yFv2K5kk=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js" integrity="sha256-QvhPq+evNjd8JyxSOU5KL3jPYTD7+gWVev1OH763SL0=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/locale/it.js" integrity="sha256-Y2D8xTTlSrBTcjPKKOeBs0zxdp9rupAIQiQZkbxVAfo=" crossorigin="anonymous"></script>
    </environment>


    <script>
        function onTabShow(tab) {
            /*NOTA: il calendario nel tab ha dei problemi con il resize della finestra.
                    Credo che il problema si dovuto più al tab che al calendario (nel senso che togliendolo dal tab non dovrebbe dare problemi).
                    L'unico modo che ho trovato per farlo funzionare è scatenare un evento di resize della window in modo esplicito (credo non funzioni su IE).
                    L'invocazione del metodo render così come l'impostazione dell'aspectRatio non producono effetti!
                    Una miglioria potrebbe essere quella di usare un solo calendario, fuori dal tab, e caricare i dati dinamicamente al cambio tab. In questo
                    modo si alleggerirebbe la pagina (non caricando gli eventi che non sono visibili).
            */
           // $(tab.id).fullCalendar('render');
            //$(tab.id).fullCalendar('option', 'aspectRatio', 2);
            window.dispatchEvent(new Event('resize'));
        }
                $.ajaxSetup({
            headers: {
   //             'X-PalestreGoGO-AUTHToken': document.getElementById('token').value
                'X-PalestreGoGO-AUTHToken':'@Html.Raw(ViewBag.AuthToken)'
            }
        });

        $(document).ready(function () {
            var instance = M.Tabs.init(document.getElementById('tabsContainer'), {
                onShow: onTabShow
            });

            var carouselElem = document.getElementById('carousel');
            var instances = M.Carousel.init(carouselElem, { fullWidth: true });

            //jQuery("#slider1").revolution({
            //    sliderType: "standard",
            //    sliderLayout: "auto",
            //    delay: 4000,
            //    navigation: {
            //        arrows: { enable: true }
            //    },
            //    gridwidth: 1230,
            //    gridheight: 720
            //});
             @foreach (var s in ViewBag.Sale)
             {
                <text>
                $('@(String.Format("#calendar-{0}", s.Id))').fullCalendar({
                    lang: "it",
                    weekends: true,
                    defaultView: "agendaWeek",
                    slotDuration: "01:00:00",
                    allDaySlot: false,
                    aspectRatio: 2,
                    agendaEventMinHeight: 120,
                    events: {
                        url: '@(string.Format("/{0}/eventi/feeds", ViewBag.ClienteRoute))',
                        type: 'GET',
                        data: { lid: '@s.Id' }
                    },
                    eventClick: function (calEvent, jsEvent, view) {
                        $("#spinner").show();
                        var url = '@Html.Raw(ViewBag.ClienteRoute)/eventi/' + calEvent.id +"/appuntamento";
                        window.location = url;
                        //TODO: Caricare loader!
                    }
                });
                </text>
            }
        });
    </script>
    <!-- Initialize Swiper -->
    <script>
        var swiper = new Swiper('.swiper-container', {
            spaceBetween: 20,
            speed: 1000,
            effect: 'fade',
            centeredSlides: true,
            loop: true,
            autoplay: {
                delay: 2500,
                disableOnInteraction: false,
            },
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });
    </script>
}
