@model ClienteHomeViewModel;

@{
    ViewData["Title"] = Model.Nome;
    Layout = "_LayoutClienti";
}

@section Header{
    <!-- RS5.0 Main Stylesheet -->
    <link rel="stylesheet" type="text/css" href="~/revolution/css/settings.css">
    <!-- RS5.0 Layers and Navigation Styles -->
    <link rel="stylesheet" type="text/css" href="~/revolution/css/layers.css">
    <link rel="stylesheet" type="text/css" href="~/revolution/css/navigation.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.2/fullcalendar.min.css">

    <style>
        .fc-time-grid .fc-slats td {
            height: 3em;
        }
    </style>

    <!-- jQuery ==> Già incluso nel layout-->
    @*<script src="~/js/jquery-2.1.3.min.js"></script>
    <script src='~/js/moment.min.js'></script>*@
}

@Html.Partial("_MenuCliente", Model.IdCliente)

<section id="clientHeroes" class="section-padding">
    <div class="container">
        <div class="clientHeroes text-center mb-80" style="background-image: url('@Model.ImmagineHome.Url')">
            <h2 class="section-title text-uppercase">@Model.Nome</h2>
        </div>
    </div>
</section>

<section id="banner1">
    <div class="container">
        <div class="row center-align">
            <div class="adsbanner_container">
                <img src="~/img/placeholders/google/leaderboard_728x90.png" />
            </div>
        </div>
    </div>
</section>

<section id="slideshow" class="padding-top-110">
    <div class="container">
        <div class="row">
            <div class="col12 rev_slider_wrapper">
                <div class="rev_slider tp-overflow-hidden">
                    <div id="slider1" class="rev_slider" data-version="5.0">
                        <ul>
                            @foreach (var i in Model.Images)
                            {
                                <li data-transition="fade">
                                    <img class="rev-slidebg" src="@i.Url" alt="@i.Alt" data-bgfit="cover" data-bgrepeat="no-repeat" data-no-retina>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
</section>

<section id="descCliente" class="padding-top-10 mt-10">
    <div class="container">
        <div class="row">
            <div class="col-sm-1 col-md2">&nbsp;</div>
            <div class="col-sm10 col-md8">
                <h1>@Model.Nome</h1>
                <h3>
                    @Model.Descrizione
                </h3>
            </div>
            <div class="col-sm-1 col-md2">&nbsp;</div>
        </div>
    </div>
</section>


<section id="banner2">
    <div class="container">
        <div class="row center-align">
            <div class="adsbanner">
                <img src="~/img/placeholders/google/leaderboard_728x90.png"/>
            </div>
        </div>
    </div>
</section>

<section id="calendars">
    <div class="container">
        @if (ViewBag.Sale != null && ViewBag.Sale.Count > 0)
        {
            <!-- TABS SALE-->
            <div class="row">
                <div class="col s12">
                    <ul id="tabsContainer" class="tabs tabs-fixed-width">
                        @foreach (var s in ViewBag.Sale)
                        {
                            <li class="tab col s3">
                                <a href='@(String.Format("#calendar-{0}",s.Id))'>@s.Nome</a>
                            </li>
                        }
                    </ul>
                </div>
                <!-- Un DIV per ciascuna sala con il calendario per quella sala -->
                @foreach (var s in ViewBag.Sale)
                {
                    <div id="@(String.Format("calendar-container-{0}",s.Id))">
                        <div id='@(String.Format("calendar-{0}",s.Id))'>

                        </div>
                    </div>
                }
            </div>
        }
    </div>
</section>

<section id="whereare">
    <div class="container">
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-8">
                    <img class="img-responsive" src="@ViewBag.MapUrl" />
                </div>
                <div class="col-md-2"></div>
            </div>
    </div>
</section>

@section Scripts{
    <script src="~/bootstrap/js/bootstrap.min.js"></script>
    @*<script src="~/materialize/js/materialize.min.js"></script>*@
    @*<script src="~/materialize-v1.0.0-alpha.4/js/materialize.min.js"></script>*@

    <script src="~/js/menuzord.js"></script>
    <script src="~/js/bootstrap-tabcollapse.min.js"></script>
    <script src="~/js/jquery.easing.min.js"></script>
    <script src="~/js/jquery.sticky.min.js"></script>
    <script src="~/js/smoothscroll.min.js"></script>
    <script src="~/js/smooth-menu.js"></script>
    <script src="~/js/jquery.stellar.min.js"></script>
    <script src="~/js/imagesloaded.js"></script>
    <script src="~/js/jquery.inview.min.js"></script>
    <script src="~/js/jquery.shuffle.min.js"></script>
    <script src="~/js/wow.min.js"></script>
    <script src="~/owl.carousel/owl.carousel.min.js"></script>
    <script src="~/flexSlider/jquery.flexslider-min.js"></script>
    <script src="~/magnific-popup/jquery.magnific-popup.min.js"></script>
    <script src="~/js/scripts.js"></script>
    <script src="~/revolution/js/jquery.themepunch.tools.min.js"></script>
    <script src="~/revolution/js/jquery.themepunch.revolution.min.js"></script>


    <script src="~/fullcalendar-3.8.2/fullcalendar.min.js"></script>
    <script src="~/fullcalendar-3.8.2/locale/it.js"></script>
    <script>


        function onTabShow(tab) {
            /*NOTA: il calendario nel tab ha dei problemi con il resize della finestra.
                    Credo che il problema si dovuto più al tab che al calendario (nel senso che togliendolo dal tab non dovrebbe dare problemi).
                    L'unico modo che ho trovato per farlo funzionare è scatenare un evento di resize della window in modo esplicito (credo non funzioni su IE).
                    L'invocazione del metodo render così come l'impostazione dell'aspectRatio non producono effetti!
                    Una miglioria potrebbe essere quella di usare un solo calendario, fuori dal tab, e caricare i dati dinamicamente al cambio tab. In questo
                    modo si alleggerirebbe la pagina (non caricando gli eventi che non sono visibili).
            */
           // $(tab.id).fullCalendar('render');
            //$(tab.id).fullCalendar('option', 'aspectRatio', 2);
            window.dispatchEvent(new Event('resize'));
        }
                $.ajaxSetup({
            headers: {
   //             'X-PalestreGoGO-AUTHToken': document.getElementById('token').value
                'X-PalestreGoGO-AUTHToken':'@Html.Raw(ViewBag.AuthToken)'
            }
        });

        $(document).ready(function () {
            var instance = M.Tabs.init(document.getElementById('tabsContainer'), {
                onShow: onTabShow
            });

            jQuery("#slider1").revolution({
                sliderType: "standard",
                sliderLayout: "auto",
                delay: 4000,
                navigation: {
                    arrows: { enable: true }
                },
                gridwidth: 1230,
                gridheight: 720
            });
             @foreach (var s in ViewBag.Sale)
             {
                <text>
                $('@(String.Format("#calendar-{0}", s.Id))').fullCalendar({
                    lang: "it",
                    weekends: true,
                    defaultView: "agendaWeek",
                    slotDuration: "01:00:00",
                    allDaySlot: false,
                    aspectRatio: 2,
                    agendaEventMinHeight: 120,
                    events: {
                        url: '@(string.Format("/{0}/eventi/feeds", ViewBag.ClienteRoute))',
                        type: 'GET',
                        data: { lid: '@s.Id' }
                    },
                    eventClick: function (calEvent, jsEvent, view) {
                        $("#spinner").show();
                        var url = '@Html.Raw(ViewBag.ClienteRoute)/eventi/' + calEvent.id +"/appuntamenti";
                        window.location = url;
                        //TODO: Caricare loader!
                    }  
                });
                </text>
            }
        });
    </script>
}