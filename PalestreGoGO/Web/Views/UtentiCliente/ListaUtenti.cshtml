@model List<ClienteUtenteViewModel>;

@{
    ViewData["Title"] = "Index";
    Layout = "_LayoutClienti";
}


@if ((Model == null) || (Model.Count == 0))
{
    <div class="row">
        <div class="col s4 offset-s4">
            <partial name="_NoUtenti" model="Model" />
        </div>
    </div>
}
else
{
    <div class="row">
        <div class="col s10 offset-s1 l8 offset-l2 center">
            <h5>Gestione Utenti</h5>
        </div>
    </div>
    <div class="row">
        <div class="col s5 offset-s1 l4 offset-l2">
            <strong>Nominativo (Cognome Nome)</strong>
        </div>
        <div class="col s2 l2">
            <strong>Stato</strong>
        </div>
        <div class="col s3 l2">
            <strong>Azioni</strong>
        </div>
    </div>
    <div class="row">
        <div class="divider col s10 l8 offset-s1 offset-l2"></div>
    </div>
    @foreach (var s in Model)
    {
        <div class="row">
            <div class="col s5 offset-s2 left" data-id-item="@s.IdUtente">@s.Nominativo</div>
            <div class="col s5 offset-s2 left">@s.StatoAbbonamento</div>
            <div class="col s3 right">
                @switch (s.StatoAbbonamento)
                {
                    case StatoAbbonamento.NessunAbbonamento:
                        <a class='dropdown-trigger btn @Html.Raw(ViewBag.TipologieAbbonamenti == null ? "disabled" : "")' href='#' data-target='@Html.Raw(string.Format("ddAddAbb-{0}", s.IdUtente));'>Nuovo Abbonamento</a>
                        <!-- Dropdown Structure -->
                        <ul id='@Html.Raw(string.Format("ddAddAbb-{0}", s.IdUtente));' class='dropdown-content'>
                            @foreach (var ta in (ViewBag.TipologieAbbonamenti as IEnumerable<KeyValuePair<int, string>>))
                            {
                                <li>
                                    <a asp-controller="Abbonamenti" asp-action="AddAbbonamentoToUser"
                                       asp-route-userId="@s.IdUtente" asp-route-tipoAbb="@ta.Key">@ta.Value</a>
                                </li>
                            }
                        </ul>
                        break;
                    default:
                        <a asp-controller="Abbonamenti" asp-action="ManageAbbonamentoUtente"
                           asp-route-userId="@s.IdUtente" class="waves-effect waves-light btn disabled">Gestione Abbonamento</a>
                        break;
                }
            </div>
        </div>
        <div class="row">
            <div class="divider col s8 offset-s2"></div>
        </div>
    }

}


@section Scripts{
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var elems = document.querySelectorAll('.dropdown-trigger');
            var instances = M.Dropdown.init(elems, {});
        });
    </script>
}
