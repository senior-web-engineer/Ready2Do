@model AbbonamentoUtenteViewModel
@{
    Layout = "_LayoutClienti";
}
<div class="row">
    <div class="col s8 offset-s2 l7 offset-l2 center-align">
        <h6>Abbonamento Utente</h6>
    </div>
</div>
<div class="row">
    <div class="col s10 offset-s2 center-align">
        <vc:user-header model="@(ViewData["Utente"] as UserHeaderViewModel)"></vc:user-header>
    </div>
</div>
<form asp-action="SaveAbbonamentoUtente" asp-controller="UtentiClienteController" method="post" id="formEditAbbonamento">
    <input type="hidden" asp-for="Id" />
    <div class="row">
        <div class="input-field col s7 offset-s2">
            <select asp-for="IdTipoAbbonamento" asp-items="@ViewBag.TipologieAbbonamenti" id="selTipoAbbonamento">
                <option disabled selected>Selezionare una tipologia di Abbonamento</option>
            </select>
        </div>
    </div>
    <div class="row">
        <div class="input-field col s8 offset-s2 l3 offset-l2">
            <input id="inputDataInizioValidita" class="datepicker" type="text" asp-for="DataInizioValidita" />
            <label>Inizio Validità:</label>
            <span asp-validation-for="DataInizioValidita" />
        </div>
        <div class="input-field col s8 offset-s2 l3 offset-l1">
            <input id="inputScadenza" class="datepicker" type="text" asp-for="Scadenza" />
            <label>Scadenza</label>
            <span asp-validation-for="Scadenza" />
        </div>
    </div>
    <div class="row">
        <div class="input-field col s8 offset-s2 l3 offset-l2">
            <input type="number" asp-for="IngressiIniziali" />
            <label>Ingressi Iniziali</label>
            <span asp-validation-for="IngressiIniziali" />
        </div>
        <div class="input-field col s8 offset-s2 l3 offset-l1">
            <input type="number" asp-for="IngressiResidui" />
            <label>Ingressi Residui</label>
            <span asp-validation-for="IngressiResidui" />
        </div>
    </div>
    <div class="row">
        <div class="input-field col s8 offset-s2 l3 offset-l2">
            <input type="number" asp-for="Importo" />
            <label>Prezzo Abbonamento</label>
            <span asp-validation-for="Importo" />
        </div>
        <div class="input-field col s8 offset-s2 l3 offset-l1">
            <input type="number" asp-for="ImportoPagato" />
            <label>Importo Pagato</label>
            <span asp-validation-for="ImportoPagato" />
        </div>
    </div>


    <div class="row">
        <div class="input-field col s10 offset-s1 center">
            <button class="btn waves-effect waves-light" type="submit" name="action">
                Salva Modifiche
                <i class="material-icons left">save</i>
            </button>
        </div>
    </div>
</form>


@section Scripts
    {
    <script>
        let urlTipoAbb = "/api/@Model.IdCliente/abbonamenti/tipologie/";
        $(document).ready(function () {
            let datetPickerI18n = {
                months: ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'],
                monthsShort: ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'],
                weekdays: ['Domenica', 'Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì', 'Sabato'],
                weekdaysShort: ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab', 'Dom'],
                weekdaysAbbrev: ['D', 'L', 'M', 'M', 'G', 'V', 'S'],
                clear: 'Cancella',
                cancel: 'Annulla',
                today: 'Oggi'
            };

            let timePickeri18n = {
                cancel: 'Annulla',
                clear: 'Cancella',
                done: 'Ok'
            };
            $('.datepicker').datepicker({
                format: "dd mmm yyyy",
                defaultDate: new Date(),
                setDefaultDate: true,
                firstDay: 1,
                minDate: new Date(),
                i18n: datetPickerI18n,
                showMonthAfterYear: true
            });

            let selTipoAbb = $('#selTipoAbbonamento');
            selTipoAbb.formSelect();
            selTipoAbb.change(function (event) {
                $.ajax({
                    method: "GET",
                    url: urlTipoAbb + event.target.value
                })
                    .done(function (data, textStatus, jqXHR) {

                        alert(data);
                        alert(textStatus);
                    })
                    .fail(function (jqXHR, textStatus, errorThrown) {
                        alert(textStatus);
                        alert(errorThrown);
                    });
            });

            
        });
    </script>
}
