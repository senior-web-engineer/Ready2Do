@using Web.Utils;

@model EventoViewModel;
@{
    Layout = "_LayoutClienti";
}
<head>
    @section Header{
        <style type="text/css">
            #formEditProfile .input-field {
                margin-top: 0px;
            }

            .input-field {
                margin-top: 0.2rem;
                margin-bottom: 0;
            }
        </style>
    }
</head>

<div class="row">
    <form class="col s12" asp-action='@(Model.Id.HasValue ? Html.Raw("edit") : Html.Raw("new"))' asp-route-id="@Model.Id" method="post">
        <input id="idEvento" type="hidden" asp-for="@Model.Id" />
        <div class="row">
            <div class="col s8 offset-s2">
                <div class="input-field">
                    <input type="text" asp-for="@Model.Title" />
                    <label asp-for="Title"></label>
                    <span asp-validation-for="Title" />
                </div>
            </div>
        </div>
        <div class="row">
            <div class="input-field col s2 offset-s2">
                <input id="dataEvento" type="text" asp-for="Data" class="datepicker" />
                <label asp-for="Data"></label>
                <span asp-validation-for="Data" />
            </div>
            <div class="input-field col s2 ">
                <input id="oraEvento" type="time" asp-for="OraInizio" class="timepicker" />
                <label asp-for="OraInizio"></label>
                <span asp-validation-for="OraInizio" />
            </div>
        </div>
        <div class="row">
            <div class="input-field col s8 offset-s2">
                <select asp-for="IdLocation" asp-items="ViewBag.Locations" class=""></select>
                <label asp-for="IdLocation"></label>
                <span asp-validation-for="IdLocation" />
            </div>
        </div>
        <div class="row">
            <div class="input-field col s8 offset-s2">
                <select asp-for="IdTipoLezione" asp-items="ViewBag.TipologieLezioni" class=""></select>
                <label asp-for="IdTipoLezione"></label>
                <span asp-validation-for="IdTipoLezione" />
            </div>
        </div>
        <div class="row">
            <div class="input-field col s3 offset-s2">
                <input type="text" asp-for="PostiDisponibili" />
                <label asp-for="PostiDisponibili"></label>
                <span asp-validation-for="PostiDisponibili" />
            </div>
        </div>
        <div class="row">
            <div class="input-field col s3 offset-s2">
                <input id="dataCancellazione" type="text" asp-for="DataCancellazioneMax" class="datepicker" />
                <label asp-for="DataCancellazioneMax"></label>
                <span asp-validation-for="DataCancellazioneMax" />
            </div>
            <div class="input-field col s3">
                <input id="oraCancellazione" type="time" asp-for='OraCancellazioneMax' class="timepicker" />
                <label asp-for="OraCancellazioneMax"></label>
                <span asp-validation-for="OraCancellazioneMax" />
            </div>
        </div>
        <div class="row">
            <div class="input-field col s8 offset-s2">
                <input type="text" asp-for="Istruttore" />
                <label asp-for="Istruttore"></label>
                <span asp-validation-for="Istruttore" />
            </div>
        </div>
        <div class="row">
            <div class="input-field col s8 offset-s2">
                <textarea asp-for="Note" class="materialize-textarea"></textarea>
                <label asp-for="Note"></label>
                <span asp-validation-for="Note" />
            </div>
        </div>
        <div class="row">
            <div class="input-field col s10 offset-s1 center">
                <button class="btn waves-effect waves-light" type="submit" name="action">
                    Salva
                    <i class="material-icons save">save</i>
                </button>
            </div>
        </div>
</form>
</div>

@section Scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js" integrity="sha256-CutOzxCRucUsn6C6TcEYsauvvYilEniTXldPa6/wu0k=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/locale/it.js" integrity="sha256-D8y560ZGsKY1LoAajKkQCG7y0Vkye361MH4yFv2K5kk=" crossorigin="anonymous"></script>

    <script>
        var i18nDate = {
            months: ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'],
            monthsShort: ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'],
            weekdays: ['Domenica', 'Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì', 'Sabato'],
            weekdaysShort: ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab', 'Dom'],
            weekdaysAbbrev: ['D', 'L', 'M', 'M', 'G', 'V', 'S'],
            clear: 'Cancella',
            cancel: 'Annulla',
            today: 'Oggi'
        };

        var i18nTime = {
            cancel: 'Annulla',
            clear: 'Cancella',
            done: 'Ok'
        };

        $(document).ready(function () {
            $('select').formSelect();

            var elemDataEvento = document.getElementById('dataEvento');
            var elemOraEvento = document.getElementById('oraEvento');
            var elemDataCancellazione = document.getElementById('dataCancellazione');
            var elemOraCancellazione = document.getElementById('oraCancellazione');
            let dataEvento = new Date("@(Model.Data.HasValue ? Model.Data.Value.ToString("dd/MM/yyyy") : DateTime.Now.ToString("dd/MM/yyyy"))");

            var datePickDataEvento = M.Datepicker.init(elemDataEvento, {
                format: "dd/mm/yyyy",
                defaultDate: dataEvento,
                setDefaultDate: true,
                minDate:  new Date(),
                i18n: i18nDate
            });

            @*@if (Model.Data.HasValue) {
                @: datePickDataEvento.date = new Date('@Model.Data.Value.ToString("yyyy-MM-dd")')
            }*@

            let dataCancellazione = new Date("@(Model.DataCancellazioneMax.HasValue ? Model.DataCancellazioneMax.Value.ToString("dd/MM/yyyy") : DateTime.Now.ToString("dd/MM/yyyy"))");

            var datePickDataCanc = M.Datepicker.init(elemDataCancellazione, {
                format: "dd/mm/yyyy",
                defaultDate: dataCancellazione,
                setDefaultDate: true,
                minDate: new Date(),
                i18n: i18nDate
            });

            @*@if (Model.DataCancellazioneMax.HasValue) {
                @: datePickDataCanc.date = new Date("@Model.DataCancellazioneMax.Value.ToString("yyyy-MM-dd")");
            }*@

            var timePickOraEvento = M.Timepicker.init(elemOraEvento, {
                twelveHour: false,
                i18n: i18nTime
            });
            @if (Model.OraInizio.HasValue)
            {
                @: timePickOraEvento.time = '@Model.OraInizio.Value.ToString(@"hh\:mm")';
            }

            var timePickOraCanc = M.Timepicker.init(elemOraCancellazione, {
                twelveHour: false,
                i18n: i18nTime
            });
            @if (Model.OraCancellazioneMax.HasValue)
            {
                @: timePickOraCanc.time = '@Model.OraCancellazioneMax.Value.ToString(@"hh\:mm")';
            }
        });
        ///*Logica per la validazione custom MVC - Da capire se applicabile*/
        //(function ($) {
        //     var $jQval = $.validator;

        //    $jQval.addMethod("nopastdatevalidation", function (value, element, params) {
        //        if (!value) return true;
        //        let date = new Date($.trim(value));
        //        if (!date || date < new Date()) return false;
        //        return true;
        //    });

        //    var adapters = $jQval.unobtrusive.adapters;
        //    adapters.addBool("nopastdatevalidation");
        //})(jQuery);
    </script>
}